<%

# BioCatalogue: app/views/search/show.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<% all_search = BioCatalogue::Search::ALL_TYPES_SYNONYMS.include?(@type) %>

<% if @query.blank? %>
	<h1>Search</h1>
<% else %>
	<% t "#{@type.titleize} &#45; Results for '#{h(@query)}'" -%>
	<% if all_search %>
		<h1>Search Results <span class="faded">(for all things in the BioCatalogue)</span></h1>
	<% else %>
		<h1>Search Results <span class="faded">(for <%= @type.titleize -%>)</span></h1>
	<% end%>
<% end %>

<div>
	
	<%= render :partial => 'search_form' %>
	
	<% if @query.blank? %>
		<p>
			<%= search_provide_query_text -%>
		</P>
	<% else %>
		<% unless @results.nil? %>
			<p>
				Search query:
				"<b><%= h @query -%></b>"
				returned <%= pluralize(@results.total, "item") -%>
			</p>
		<% end %>
	<% end %>
	
</div>

<br/>
	
<% unless @query.blank? %>

	<% if @results.nil? or @results.total == 0 %>
	
	  <p class="none_text">No items found</p>
	  
	<% else %>
	
		<% if all_search %>
		
			<div id="search_results" class="tabber">
				<% @results.result_types.each do |result_type| %>
				
					<% 
						 visible_result_type = result_type.titleize
						 items = search_item_ids_to_objects(@results.item_ids(result_type, 1), result_type)
						 count = @results.count(result_type)
						 more_items = count > PAGE_ITEMS_SIZE 
					%>
					
					<% unless items.empty? %>
						<div id='<%= "tab-#{result_type}" -%>' class="tabbertab">
							<% count_text = more_items ? "#{items.length} of #{count}" : "#{items.length}"  %>
					    <h3><%= "#{visible_result_type} (#{count_text})" -%></h3>
							
							<% if more_items %>
								<table style="width:100%; margin: 0 0 1.5em 0;">
									<tr>
										<td style="color: #555;">
											<%= "Showing the top #{items.length} items out of #{count} in total" -%>
										</td>
										<td style="text-align: right;">
											<%= link_to("Click here to see all #{visible_result_type} for '#{h(@query)}'", search_url(:q => @query, :t => result_type, :page => 2)) -%>
										</td>
									</tr>
								</table>
							<% end %>
							
							<%= render :partial => "#{result_type}/listing", :locals => { :items => items } %>
							
							<% if more_items %>
								<p style="text-align: right;">
									<%= link_to("Click here to see all #{visible_result_type} for '#{h(@query)}'", search_url(:q => @query, :t => result_type, :page => 2)) -%>
								</p>
							<% end %>
					  </div>
					<% end %>
					
				<% end %>
			</div>
	
			<%= render :partial => 'shared/tabber_startup' -%>
		
		<% else %>
		
			<% 
				 result_type = @type
				 item_ids = @results.item_ids(result_type, params[:page])
				 items = search_item_ids_to_objects(item_ids, result_type)
			%>
			
			<%= render :partial => 'widgets/pagination_top', :locals => { :paginated_items => item_ids, :entry_name => @type.gsub('_', ' ').singularize } %>
			
			<div id="search_results" style="margin: 2em 0;">
				<%= render :partial => "#{@type}/listing", :locals => { :items => items } %>
			</div>
				
			<%= render :partial => 'widgets/pagination_bottom', :locals => { :paginated_items => item_ids } %>
		
		<% end%>
	
	<% end %>

<% end %>

<br />

