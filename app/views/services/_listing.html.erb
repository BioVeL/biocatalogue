<%

# BioCatalogue: app/views/services/_listing.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<div class="listings">
	<% items.each do |service| %>
		<% unless service.nil? %>
			<% service_version_instance = service.latest_version.service_versionified %>
			<div class="listing_item">
				<p class="name">
					<%= link_to(h(service.name), service_path(service)) -%>
					<%= service_type_badges(service.service_types) -%>
					<%= service_location_flags(service) -%>
				</p>
				
				<%= render :partial => "annotations/descriptions",
							 		 :locals => { :annotatable => service_version_instance,
																:show_header => false,
																:truncate_desc => 150,
																:auto_link_desc => false } -%>
				
				<p class="detail">
					<b>Provider:</b>
					<% service.providers.each do |provider| %>
						<%= link_to(h(provider.name), service_provider_path(provider)) %>
					<% end %>
					|
					<b>Submitted by:</b>
					<%= link_to(h(service.submitter.display_name), user_path(service.submitter)) %>
					(<%= distance_of_time_in_words_to_now(service.created_at) -%> ago)
				</p>
				
				<p class="detail">
					<b>Tags:</b>
					<% unless (tag_annotations = service.annotations_with_attribute("tag")).empty? %>
						| 
						<% tag_annotations.map{|ann| ann.value}.uniq.sort.each do |val| %>
							<%= h(val) -%> |
						<% end %>
					<% else %>
						<span class="none_text">none</span>
					<% end %>
				</p>
			</div>
		<% end %>
	<% end %>
</div>
