<%

# BioCatalogue: app/views/services/_listing.html.erb
#
# Copyright (c) 2009, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<div class="listings">
	<% items.each do |service| %>
		<% unless service.nil? %>
			<% service_version_instance = service.latest_version.service_versionified %>
			<div class="listing_item">
				<table style="width: 100%;">
					<tr>
						<td>
							
							<p class="name_box">
								<span class="name"><%= link_to(h(service.name), service_path(service)) -%></span>
								<%= service_type_badges(service.service_types) -%>
								<%= service_location_flags(service) -%>
							</p>
							
							<%= render :partial => "annotations/name_aliases",
												 :locals => { :annotatable => service,
																			:name_annotations => all_name_annotations_for_service(service),
																			:show_add_option => false,
																			:show_modify_options => false,
																			:show_none_text => false } -%>
							
						</td>
						<td style="text-align:right;">
							
							<%= render :partial => "services/annotation_counts",
										 :locals => { :service => service } -%>
							
						</td>
					</tr>
				</table>
				
				<div style="margin-top: 0.6em;">
					<%= render :partial => "annotations/categories", 
										 :locals => { :service => service,
																	:show_add_option => false,
																	:show_modify_options => false } -%>
				</div>
				
				<div style="margin-top: 0.8em;">
					<%= render :partial => "annotations/descriptions",
								:locals => { :annotatable => service_version_instance,
									:show_header => false,
									:truncate_desc => 100,
									:auto_link_desc => false,
									:show_modify_options => false } -%>
				</div>
					
				<table style="width:100%;">
					<tr>
						<td>
							
							<p class="detail">
								
								<b>Provider:</b>
								<% service.providers.each do |provider| %>
									<%= link_to(h(provider.name), service_provider_path(provider), :style => "vertical-align: middle;") %>
								<% end %>
								
								<span class="faded" style="margin: 0 0.2em; vertical-align: middle;">|</span>
								
								<b>Submitter / Source:</b>
								<%= submitter_link(service.submitter) %>
								<span class="ago" style="vertical-align: baseline;">
									(<%= distance_of_time_in_words_to_now(service.created_at) -%> ago)
								</span>
								
							</p>
							
							<div class="detail">
								<table>
									<tr>
										<td style="width: 12em; line-height: 1.5; padding-top: 1px;">
											<b>Tags on this service:</b>
										</td>
										<td>
											<%= render :partial => "annotations/tags_flat",
														 		 :locals => { :annotatable => service,
																							:show_add_option => false } -%>
										</td>
									</tr>
								</table>
							</div>
							
							<%= render :partial => "#{service_version_instance.class.to_s.pluralize.underscore}/service_listing_info", 
							 	 				 :locals => { :service_version_instance =>  service_version_instance } %>
							
						</td>
						
						<td style="width: 60px; text-align: right; vertical-align: bottom; padding-bottom: 0.5em;">
							<%= service_latest_status_symbol(service) -%>
						</td>
					</tr>
					
				</table>
				
			</div>
		<% end %>
	<% end %>
</div>
