<%

# BioCatalogue: app/views/services/_listing.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<div class="listings">
	<% items.each do |service| %>
		<% unless service.nil? %>
			<% service_version_instance = service.latest_version.service_versionified %>
			<div class="listing_item">
				<p class="name">
					<%= link_to(h(service.name), service_path(service)) -%>
					<%= service_type_badges(service.service_types) -%>
					<%= service_location_flags(service) -%>
				</p>
				
				<div class="box_annotations">
					<% unless (desc = h(service.description)).blank? %>
						<div class="box_annotation_provider">
							<p class="annotation_provenance_text" style="float:right;margin-left:1em;">
								from <b>service description document</b> (<%= distance_of_time_in_words_to_now(service_version_instance.created_at) -%> ago)
							</p>
							<%= truncate(desc, :length => 150) -%>
						</div>
					<% end %>
					
					<% service_version_instance.annotations_with_attribute("description").each do |ann| %>
						<div class="<%= annotation_source_cssclass(ann) -%>">
							<%= annotation_source_text(ann, "float:right;margin-left:1em;") -%>
							<%= truncate(h(ann.value), :length => 150) -%>
						</div>
					<% end %>
				</div>
				
				<p class="detail">
					<b>Provider:</b>
					<% service.providers.each do |provider| %>
						<%= link_to(h(provider.name), service_provider_path(provider)) %>
					<% end %>
					|
					<b>Submitted by:</b>
					<%= link_to(h(service.submitter.display_name), user_path(service.submitter)) %>
					(<%= distance_of_time_in_words_to_now(service.created_at) -%> ago)
				</p>
				
				<p class="detail">
					<b>Tags:</b>
					<% unless (tag_annotations = service.annotations_with_attribute("tag")).empty? %>
						| 
						<% tag_annotations.each do |ann| %>
							<%= h(ann.value) -%> |
						<% end %>
					<% else %>
						<span class="none_text">none</span>
					<% end %>
				</p>
			</div>
		<% end %>
	<% end %>
</div>
