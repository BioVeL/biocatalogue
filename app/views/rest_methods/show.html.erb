<%
  
  # BioCatalogue: app/views/rest_methods/show.html.erb
  #
  # Copyright (c) 2009, University of Manchester, The European Bioinformatics 
  # Institute (EMBL-EBI) and the University of Southampton.
  # See license.txt for details
  
%>

<% 
  t "Details for endpoint: #{@rest_method.display_endpoint}" 

  show_button = logged_in? && BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, @rest_method)
%>


<h1>
	REST Endpoints on Service:
	<%= link_to display_name(@rest_service.service), service_url(@rest_service.service, :anchor => "endpoints") -%>
</h1>

<div style="margin-bottom: 1.5em;">
  <%= link_to image_tag(icon_filename_for(:arrow_backward)) + content_tag(:span, " Back To Service \"#{display_name(@rest_service.service)}\""),
						  service_url(@rest_service.service, :anchor => "endpoints"), :class => "button_slim", :style => "margin-right:1.5em;" -%>

	<%= add_endpoints_by_popup(@rest_service, 
                               :style => "float:none;", 
                               :class => "button_slim") if show_button %>

</div>

<a name='endpoints_top'></a>
	
<div class="operations_quick_browse_box">
	<span class="heading">
		Quick Browse
	</span>
	|
  <% @rest_service.rest_resources.sort.each do |res| %>
    <% res.rest_methods.sort.each do |meth| %>
      <span class="entry">
        <%= link_to(display_name(meth), meth, :class => (meth == @rest_method ? 'active' : '')) -%>
      </span>
			|
    <% end %>
  <% end %>
</div>

<div class="vtabs_container">
	
  <!-- TABS BAR -->  
  <div class="vtabs_tab_bar" style="width:25%;">
    <ul>
       <% @rest_service.rest_resources.sort.each do |resource| %>
        <% resource.rest_methods.sort.each do |meth| %>
          <li class="<%= meth == @rest_method ? 'active' : '' -%>" title="<%= tooltip_title_attrib(meth.display_endpoint) -%>">
            <% if meth.endpoint_name %>
              <% label = content_tag(:span, truncate(display_name(meth), :length => 27), :class => 'name') + "<br/>" + content_tag(:span, truncate(meth.display_endpoint, :length => 35), :class => 'detail') %>
            <% else %>
              <% label = content_tag(:span, truncate(meth.display_endpoint, :length => 27), :class => 'name') + "<br/>" %>
            <% end %>

            <%= link_to  label, meth -%>
          </li>
        <% end %>
      <% end %>
    </ul>
  </div>
   
  <!-- MAIN AREA-->
  <div class="vtabs_tab_content" style=" width:72%;">
    <% resource = @rest_method.rest_resource %>

    <h1>
      <span class="actions_link_container">
        <% button_css = "margin-right: 8px; padding:7px; font-size:80%; font-weight:bold;" %>
        <%= link_to "Delete", @rest_method,
                              :confirm => "Are you you want to delete this endpoint.  This cannot be undone.", 
                              :method => :delete,
                              :style => "#{button_css} width:55px; right:0px;",
                              :class => "delete_link button_slim" if BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, @rest_method) %>
        
        <%= edit_endpoint_property_by_popup(@rest_method, "resource_path",
                                            :link_text => "Edit",
                                            :class => "edit_link button_slim",
                                            :style => "#{button_css} width:47px;") -%>

      </span>

      <%= h @rest_method.display_endpoint -%>    
    </h1>
    
    <div class="operation_box">        
      <div>
        <div style="float: left; width: 73%;">
          <div style="margin-bottom: 1.2em;">            
            <%= render :partial => "rest_methods/endpoint_name" -%>
          </div>
          
          <div style="margin-bottom: 1.2em;">
            <b>Template:</b>
            <%= help_icon_with_tooltip("This is an example of how the endpoint's URL will look. This includes the minimal set of parameters needed to be able to use the endpoint.") -%>
            
           <%= create_url_template(@base_endpoint, resource, @rest_method) -%>
          </div>
          
          <div>
            <%= render :partial => "annotations/descriptions",
              :locals => { :annotatable => @rest_method } -%>
          </div>
          
          <div>
            <%= render :partial => "annotations/example_endpoints",
              :locals => { :annotatable => @rest_method } -%>
          </div>
          
          <div>
            <%= render :partial => "annotations/documentation_urls",
                       :locals => { :annotatable => @rest_method } -%>
          </div>

        </div>
          
        <div style="float: right; width: 25%; font-size: 85%; margin-top:10px;">
          <%= render :partial => "annotations/tags_box",
            :locals => { :annotatable => @rest_method } -%>
        </div>
          
        <span class="clear"></span>
      </div>
          
      <br />
      <%= render :partial => "rest_parameters/input_parameters", 
                 :locals => {:method => @rest_method, :resource => resource} -%>

      <%= render :partial => "rest_representations/representation", 
                 :locals => {:method => @rest_method, 
                             :resource => resource,
                             :is_http_request => true} if %w{ POST PUT }.include?(@rest_method.method_type) -%>

      <%= render :partial => "rest_representations/representation", 
                 :locals => {:method => @rest_method, 
                             :resource => resource,
                             :is_http_request => false} -%>
      <br/>
    </div>
  </div>
</div>

<span class="clear"></span>

<p style="margin: 1.5em 0 1.5em 0; font-size: 93%; text-align: right;">
	<a href="#endpoints_top">Back to top</a>
</p>
