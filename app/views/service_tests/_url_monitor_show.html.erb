<%
  
  # BioCatalogue: app/views/service_tests/_urlmonitor_show.html.erb
  #
  # Copyright (c) 2010, University of Manchester, The European Bioinformatics 
  # Institute (EMBL-EBI) and the University of Southampton.
  # See license.txt for details
  
%>

<div id="tab-availability" class="tabbertab">
	<div>
		<% if service_test.activated? || (logged_in? && BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, service_test.service)) -%>		
			<div class="monitoring_section">
				<h5>
					<div style="text-align: left;"> 
						<p>
							<% if service_test.test.parent_type =="Annotation" -%>
								<%= h(service_test.test.parent.attribute.name.titleize) -%> : 
							<%else%>
								<%= h(service_test.test.property.titleize) -%> : 
							<%end%>
							<%= h(service_test.test.parent.send(service_test.test.property)) -%>
						</p>
					</div>	
				</h5>
				<% unless service_test.unchecked? -%>
					<div id="chart_info" style="float:right;" >
					 	<span style="font-size: 3em;"><%= service_test.success_rate -%> % </span>
					 	<%= info_icon_with_tooltip("Historical success rate for this test since its monitoring started.") -%>
					</div>
				<%end%>
				
				<div style="text-align: left;">
					<p>
						<% if ms = service_test.monitored_since -%> 
							<b></>Monitored Since :</b>  <%=h ms -%>
						<%end%>
					</p>
				</div>
							
				<div style="padding-right: 1em;">
					<%= service_test_status_symbol(service_test) -%>
				</div>
	
				<p>
					<b>Recent History</b>
				</p>
						
				<div class="box_indented_with_bar">
					<ul>
						<% unless (test_hist = service_test.recent_test_results).blank? -%>
							<% test_hist.each do |hist| %>
							<li class="container_middled">
								<%= test_result_status_symbol(hist) %> 
								<span><%= distance_of_time_in_words_to_now(hist.created_at) -%> ago</span>
							</li>
						<% end %>
						<% else %>
							<li class="none_text">No previous checks</li>
						<% end %>
					</ul>
				</div>
				<div style="text-align: right;">
					<%if logged_in? && BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, service_test.service) %>
						<% if service_test.activated? %>
							<%= link_to("Disable", disable_service_test_url(service_test), :method => :put, :confirm => "Are you sure you want to disable this test?", :class => "button_slim") -%>
						<% else %>
							<b>This test has been disabled. Click button to re-enable. </b>
							<%= link_to("Enable", enable_service_test_url(service_test), :method => :put, :confirm => "Are you sure you want to enable this test?", :class => "button_slim") -%>
						<% end %>
					<% end %>
				</div>	
				
				<%unless service_test.latest_status.label.downcase == 'unchecked' %>
					<div id="line_chart" style="margin-top: 2em; border-top: 2px solid #CCF; padding-top: 1em;" ></div>
				<%end%>
				
			</div>
		<%end%>
	</div>
</div>

<%=render :partial => 'line_chart', :locals => {:service_test => service_test } -%>
