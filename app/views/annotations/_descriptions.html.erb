<%

# BioCatalogue: app/views/annotations/_descriptions.html.erb
#
# Copyright (c) 2009, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%# Set defaults for optional parameters to this partial... %>
<% show_header = true unless local_assigns.has_key?(:show_header) %>
<% truncate_desc = false unless local_assigns.has_key?(:truncate_desc) %>
<% auto_link_desc = true unless local_assigns.has_key?(:auto_link_desc) %>
<% show_modify_options = true unless local_assigns.has_key?(:show_modify_options) %>
<% show_none_text = true unless local_assigns.has_key?(:show_none_text) %>

<% unless annotatable.nil? %>
	<div class="annotations_container">
		<% if show_header == true %>
			<div style="margin-top: 1em; line-height: 2.0;">
			  <b>Description(s):</b>
				
				<div class="add_option">
					<%= annotation_add_by_popup_link annotatable,
					     :attribute_name => "Description",
							 :link_text => "Add a description",
					     :tooltip_text => "Click to add a description",
					     :style => "margin-left: 1em;"
					-%>
				</div>
	
			</div>
		<% end %>
		
		<div class="box_annotations">
			<% unless (desc = annotatable.description).blank? %>
				<div class="description">
					<p class="annotation_source_text annotation_source_provider">
						from <b>service description document</b> (<%= distance_of_time_in_words_to_now(annotatable.created_at) -%> ago)
					</p>
					<div>
						<%= annotation_prepare_description(desc, 
																							 (truncate_desc != false), 
																							 (truncate_desc ==  false ? nil : truncate_desc), 
																							 auto_link_desc) -%>
					</div>
				</div>
			<% end %>
			
			<% descriptions_annotations = annotatable.annotations_with_attribute("description") %>
			<% unless descriptions_annotations.empty? %>
				<% descriptions_annotations.each do |ann| %>
					<div class="description">
						<%= annotation_source_text(ann) -%>
						<div>
							<%= annotation_prepare_description(ann.value, 
																								 (truncate_desc != false), 
																								 (truncate_desc ==  false ? nil : truncate_desc), 
																								 auto_link_desc) -%>
						</div>
						<% if mine?(ann) and (show_modify_options == true) %>
							<p class="actions">
								<span><%= annotation_edit_by_popup_link(ann) -%></span>
								<span style="margin-left: 1em;"><%= link_to("delete", annotation_path(ann), :method => :delete, :confirm => "Are you sure you want to delete this description?", :style => 'vertical-align: middle;')-%></span>
							</p>
						<% end %>
					</div>
				<% end %>
			<% else %>
				<% if show_none_text == true and annotatable.description.blank? %>
					<span class="none_text">none</span>
				<% end %>
			<% end %>
		</div>
	</div>
<% end %>
