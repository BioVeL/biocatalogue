<%

# BioCatalogue: app/views/rest_parameters/_constraints.html.erb
#
# Copyright (c) 2009, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%
	main_div_id = "constraints_#{rand(10000000)}"
  
  make_mandatory_or_optional_style = "float:right; font-size:80%;"
  
  meth = RestMethod.find(rest_method_id)
  can_edit = BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, parameter, :rest_method => meth)  
%>

<% unless parameter.nil? %>
	<div id="<%= main_div_id -%>" class="annotations_container">
		<div style="margin-top: 1em;">
		  <b>Constraint(s):</b> 

      <span>
        <%= help_icon_with_tooltip("These are 'specifications' stating how a parameter should be used.") %>
      </span>

      <span class="none_text" style="font-size: 85%;">
        <% if logged_in? && !can_edit %>
          You are not allowed to edit the constraints of this parameter.
        <% end %>
      </span>            
    </div>
		
		<div class="box_annotations">
      <% rounded(annotation_text_item_background_color, "#333", "100%") do %>

        This parameter is 
        <% if parameter.required %>
          <b>mandatory</b>.
          <span style= <%=h make_mandatory_or_optional_style %> >
            <%= link_to "make optional", :controller => "rest_parameters",
                                         :action => 'make_optional_or_mandatory',
                                         :id => parameter.id,
                                         :rest_method_id => rest_method_id,
                                         :make_optional => true if can_edit -%>
          </span>
        <% else %>
          <b>optional</b>.
          <span style= <%=h make_mandatory_or_optional_style %> >
            <%= link_to "make mandatory", :controller => "rest_parameters",
                                          :action => 'make_optional_or_mandatory',
                                          :id => parameter.id,
                                          :rest_method_id => rest_method_id,
                                          :make_optional => false if can_edit -%>
          </span>
        <% end %>
      <% end %>
      
      <% parameter.constrained_options.each do |c| %>
        <% rounded(annotation_text_item_background_color, "#333", "100%") do %>
          <%= c %>
          <span style= <%=h make_mandatory_or_optional_style %> >
            <%= edit_constraint_by_popup(parameter, :constraint => c, 
                                                    :rest_method_id => rest_method_id) -%>
            &nbsp; &nbsp;
              
            <%= link_to "delete", { :id => parameter.id, 
                                  :action => :remove_constraint,
                                  :constraint => c,
                                  :rest_method_id => rest_method_id}, 
                                  :confirm => "Are you you want to delete this constraint?  This cannot be undone.",
                                  :method => :put if can_edit -%>
          </span>
        <% end %>
      <% end %>
      
		</div>
		
		<% if logged_in? %>
      <%= render :partial => "rest_parameters/add_constraint_box",
                 :locals => { :partial_from => "constraints",
                              :parameter_id => parameter.id,
                              :rest_method_id => rest_method_id,
                              :text_area_default_text => "Add a constraint...",
                              :main_div_id => main_div_id } if can_edit -%>
		<% else %>
			<div class="login_link_box">
				<small><%= link_to("Login to add constraints", login_path) -%></small>
			</div>
		<% end %>
	</div>  
<% end %>