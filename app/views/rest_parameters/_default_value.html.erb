<%

# BioCatalogue: app/views/rest_parameters/_default_value.html.erb
#
# Copyright (c) 2009, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%
	main_div_id = "default_value_#{rand(10000000)}"
  
  make_mandatory_or_optional_style = "float:right; font-size:80%;"
  
  meth = RestMethod.find(rest_method_id)
  can_edit = BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, parameter, :rest_method => meth)  
%>

<% unless parameter.nil? %>
	<div id="<%= main_div_id -%>" class="annotations_container">
		<div style="margin-top: 1em;">
		  <b>Default Value:</b> 

      <span>
        <%= help_icon_with_tooltip("This is the value which will be used for service monitoring purposes.  Any value entered will be URL encoded.") %>
      </span>

      <span class="none_text" style="font-size: 85%;">
        <% if logged_in? && !can_edit %>
          You are not allowed to edit the constraints of this parameter.
        <% end %>
      </span>            
    </div>
		
    <% if !parameter.default_value.blank? %>
      <div class="box_annotations">
        <% rounded(annotation_text_item_background_color, "#333", "100%") do %>
          <%=h parameter.default_value %>

          <span style= <%=h make_mandatory_or_optional_style %> >
            <%= edit_default_value_by_popup(parameter,
                                            :rest_method_id => rest_method_id) -%>
            &nbsp; &nbsp;
            <% if can_edit %>
              <a href='<%= "/rest_parameters/remove_default_value/#{parameter.id}?rest_method_id=#{rest_method_id}"-%>'
                 onclick="if (confirm('Are you you want to delete the default value.  This cannot be undone.')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '<%= form_authenticity_token -%>'); f.appendChild(s);f.submit(); };return false;" 
                 style="margin-right: 0px;">delete</a>
            <% end %>
          </span>
        <% end %>
      </div>
		<% elsif !logged_in? %>
      <span class="none_text" style="font-size: 85%;">
        No default value specified.
      </span>
    <% else %>
      <%= render :partial => "rest_parameters/add_default_value_box",
                 :locals => { :partial_from => "default_value",
                              :parameter_id => parameter.id,
                              :rest_method_id => rest_method_id,
                              :text_area_default_text => "Add a default value...",
                              :main_div_id => main_div_id } if can_edit -%>
    <% end %>

		<% unless logged_in? %>
			<div class="login_link_box">
				<small><%= link_to("Login to add a default value", login_path) -%></small>
			</div>
		<% end %>
	</div>  
<% end %>