<%

# BioCatalogue: app/views/rest_parameters/_input_parameters.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%
  endpoint ||= ""
%>

<b>Input Parameters:</b>
<%= add_endpoints_by_popup(method, :style => "font-size: 95%;") %>

<div class="box_indented_with_bar" style="margin: 1em 0 0 1.5em;">
  
  <% unless method.request_parameters.blank? %>      
    <% method.request_parameters.each do |param| %>

      <div class="port">
        <% if BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, param, :rest_method => method) %>
          <span class="method_param_link_container">
            <%= link_to "Delete", rest_parameter_url(param, :rest_method_id => method.id),
                :confirm => "Are you you want to delete this parameter?",
                :method => :delete,
                :class => "method_param_delete_link" %>
            
            <% if param.name.start_with?'UNIQUE_TO_METHOD_' %>
                <%= link_to "Globalise", 
                    {:controller => "rest_parameters",
                     :action => "localise_globalise_parameter", 
                     :id => param.id,
                     :rest_method_id => method.id,
                     :make_unique => false,
                     :endpoint => endpoint},
                    :confirm => "Are you you want to make this parameter global.  All annotations that are currently associated with this parameter will be lost and  the generic annotations will be added.",
                    :class => "link_param_link" %>
            <% else %>
                <%= link_to "Localise", 
                    {:controller => "rest_parameters",
                     :action => "localise_globalise_parameter", 
                     :id => param.id,
                     :rest_method_id => method.id,
                     :make_unique => true,
                     :endpoint => endpoint},
                    :confirm => "Are you you want to this parameter unique to this endpoint.  You will lose all annotations that are currently associated with this parameter.",
                    :class => "unlink_param_link" %>
            <% end %>
          </span>
        <% end %>

        <% uniq_id = "R#{resource.id}M#{method.id}P#{param.id}" %>
        <% link_content = "<b>" + param.name.sub(/UNIQUE_TO_METHOD_\d+\-/, '') + "</b>" %>
        <% link_content += "   <i>*</i>" if param.name.start_with?"UNIQUE_TO_METHOD_" %>

        <%= create_component_dropdown_title(uniq_id, :link_text => link_content, :icon_float => "right") -%>

        <div id='<%=h uniq_id %>' style="display:none;">
          <span class="clear"></span>
                              
          <div style="; float: right; width: 24%; font-size: 85%;">
            <%= add_submitter_text(method.request_parameters.find(param.id)) %>

            <br/><br/><br/>
            <%= render :partial => "annotations/tags_box",
                       :locals => { :annotatable => param } -%>
          </div>
          
          <div style="width:73%;">
            <%= render :partial => "annotations/constraints",
                       :locals => { :parameter => param, :rest_method_id => method.id } -%>
                        
            <%= render :partial => "annotations/descriptions",
                       :locals => { :annotatable => param } -%>
            
            <%= render :partial => "annotations/examples",
                       :locals => { :annotatable => param } -%>
            
            <%= render :partial => "annotations/other_annotations",
                       :locals => { :annotatable => param } -%>
            
            <br />
          </div>
        </div>                       
      </div>
    <% end %>
  <% else %>
    <span class="none_text">None Specified</span>
  <% end %>

  <span class="clear"></span> 
</div>
