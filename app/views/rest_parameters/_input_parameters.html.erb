<%

# BioCatalogue: app/views/rest_parameters/_input_parameters.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%
  endpoint ||= ""
%>

<b>Input Parameters:</b>
<%= add_endpoints_by_popup(method, :class => "button_slim") %>

<div class="box_indented_with_bar" style="margin: 1em 0 0 1.5em;">
  
  <% unless method.request_parameters.blank? %>      
    <% method.request_parameters.each do |param| %>

      <div class="port">
        <% if BioCatalogue::Auth.allow_user_to_curate_thing?(current_user, param, :rest_method => method) %>
          <span class="method_param_link_container">
            <%= link_to "Delete", rest_parameter_url(param, :rest_method_id => method.id),
                :confirm => "Are you you want to delete this parameter?",
                :method => :delete,
                :style => "width: 47px; padding:2px;",
                :class => "method_param_delete_link" %>
            
            <% unless param.is_global %>
              <% tooltip = help_icon_with_tooltip("Make this parameter global. All annotations added to a globalised " +
                           "parameter will reflect in other global parameters of the same name present in different " + 
                           "endpoints of this REST service.") %>

              <%= link_to "Globalise " + tooltip, 
                  {:controller => "rest_parameters",
                   :action => "localise_globalise_parameter", 
                   :id => param.id,
                   :rest_method_id => method.id,
                   :make_local => false,
                   :endpoint => endpoint},
                  :confirm => "Are you you want to make this parameter global.  All annotations that are currently associated with this parameter may be lost and the generic annotations will be added.  Deleted annotations cannot be retrieved.",
                  :style => "padding:1px;",
                  :class => "link_param_link" %>
            <% else %>
              <% tooltip = help_icon_with_tooltip("Create a copy of this paramater that is unique to this endpoint.  " +
                           "All annotations added to the localised copy will not be added to any other parameters " +
                           "of the same name from other endpoints of this REST service.  No annotations are carried " +
                           "across after localisation.") %>
              <%= link_to "Localise " + tooltip, 
                  {:controller => "rest_parameters",
                   :action => "localise_globalise_parameter", 
                   :id => param.id,
                   :rest_method_id => method.id,
                   :make_local => true,
                   :endpoint => endpoint},
                  :confirm => "Are you you want to make this parameter unique to this endpoint.",
                  :style => "padding:1px;",
                  :class => "unlink_param_link" %>
            <% end %>
          </span>
        <% end %>

        <% uniq_id = "R#{resource.id}M#{method.id}P#{param.id}" %>
        <% link_content = "<b>" + h(param.name) + "</b>" %>
        <% link_content += "&nbsp; &nbsp; <i class='none_text' style=' margin:auto; font-size: 85%;'>Unique to endpoint: #{h(endpoint)}</i>" unless param.is_global %>

        <%= create_expand_collapse_link(uniq_id, 
                                        :link_text => link_content, 
                                        :icon_float => "right",
                                        :class => "parameter_collapsable_title") -%>

        <div id='<%=h uniq_id %>' style="display:none;">
          <span class="clear"></span>
                              
          <div style="; float: right; width: 24%; font-size: 85%;">
            <%= add_submitter_text(method.request_parameters.find(param.id)) %>

            <br/><br/><br/>
            <%= render :partial => "annotations/tags_box",
                       :locals => { :annotatable => param } -%>
          </div>
          
          <div style="width:73%;">
            <%= render :partial => "rest_parameters/default_value",
                       :locals => { :parameter => param, :rest_method_id => method.id } -%>

            <%= render :partial => "rest_parameters/constraints",
                       :locals => { :parameter => param, :rest_method_id => method.id } -%>
                        
            <%= render :partial => "annotations/descriptions",
                       :locals => { :annotatable => param } -%>
            
            <%= render :partial => "annotations/examples",
                       :locals => { :annotatable => param } -%>
            <br />
          </div>
        </div>                       
      </div>
    <% end %>
  <% else %>
    <span class="none_text">None Specified</span>
  <% end %>

  <span class="clear"></span> 
</div>
