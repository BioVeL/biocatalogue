<%

# BioCatalogue: app/views/rest_parameters/_input_parameters.html.erb
#
# Copyright (c) 2008, University of Manchester, The European Bioinformatics 
# Institute (EMBL-EBI) and the University of Southampton.
# See license.txt for details

%>

<%
  endpoint ||= ""
%>

<b>Input Parameters:</b>
<%= add_endpoints_by_popup(method, :class => "button_slim") %>

<div class="box_indented_with_bar" style="margin: 1em 0 0 1.5em;">
  
  <% unless method.request_parameters.blank? %>      
    <% method.request_parameters.each do |param| %>

      <div class="port">
        <!--ACTION LINKS-->
        <div class="actions_link_container">
          <%= link_to "Delete", rest_parameter_url(param, :rest_method_id => method.id),
                                                          :confirm => "Are you you want to delete this parameter?",
                                                          :method => :delete,
                                                          :class => "delete_link",
                                                          :style => "width:45px;" %>
              
          <% if param.required %> <!--MAKE OPTIONAL-->
            <%= link_to "Make optional", {:controller => "rest_parameters",
                                          :action => 'make_optional_or_mandatory',
                                          :id => param.id,
                                          :rest_method_id => method.id,
                                          :make_optional => true},            
                                         :method => :put,
                                         :class => "make_optional_link" -%>
          <% else %> <!--MAKE MANDATORY-->
            <%= link_to "Make required", {:controller => "rest_parameters",
                                          :action => 'make_optional_or_mandatory',
                                          :id => param.id,
                                          :rest_method_id => method.id,
                                          :make_optional => false},
                                         :method => :put,
                                         :class => "make_required_link" -%>
          <% end %>

        </div>

        <% uniq_id = "R#{resource.id}M#{method.id}P#{param.id}" %>
        <% link_content = "<b>" + h(param.name) + "</b>" %>
        <% link_content = content_tag(:span, link_content, :class => "operation_name") if param.required %>
        
        <%= create_expand_collapse_link(uniq_id, 
                                        :link_text => link_content, 
                                        :icon_float => "right",
                                        :class => "collapsable_title") -%>

        <div id='<%=h uniq_id %>' style="display:none;">
          <span class="clear"></span>
          
          <% render :partial => "rest_parameters/parameter_actions",
                     :locals => { :method => method, :param => param } -%>
          
          <!-- SUBMITTER AND TAGS BOX -->
          <div style="float: right; width: 28%; font-size: 85%; margin-top:10px;">
            <%= add_submitter_text(method.request_parameters.find(param.id)) %>

            <br/><br/><br/>
            <%= render :partial => "annotations/tags_box",
                       :locals => { :annotatable => param } -%>
          </div>
          
          <!--ANNOTATIONS-->
          <div style="width:70%;">
            <%= render :partial => "rest_parameters/default_value",
                       :locals => { :parameter => param, :rest_method_id => method.id } -%>
                        
            <%= render :partial => "annotations/descriptions",
                       :locals => { :annotatable => param } -%>

            <%= render :partial => "rest_parameters/constrained_options",
                       :locals => { :parameter => param, :rest_method_id => method.id } -%>
            
            <%= render :partial => "annotations/examples",
                       :locals => { :annotatable => param } -%>
            <br />
          </div>
        </div>                       
      </div>
    <% end %>
  <% else %>
    <span class="none_text">None Specified</span>
  <% end %>

  <span class="clear"></span> 
</div>
